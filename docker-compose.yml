version: '2'

services:
  # proxy:
  #   build: nginx/
  #   container_name: "portainer-proxy"
  #   ports:
  #     - "80:80"
  #   networks:
  #     - local

  templates:
    image: portainer/templates
    container_name: "portainer-templates"

  portainer:
    image: portainer/portainer
    container_name: "portainer-app"
#Automatically choose 'Manage the Docker instance where Portainer is running' by adding <--host=unix:///var/run/docker.sock> to the command
    command: --templates http://templates/templates.json
    labels:
      - traefik.backend=portainer-app
      - traefik.port=9000
      - traefik.frontend.rule=Host:portainer.${HOST_IP}.xip.io
      - traefik.frontend.passHostHeader=true
      - traefik.docker.network=proxy
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./data:/data

  watchtower:
    image: v2tec/watchtower
    container_name: "portainer-watchtower"
    command: --cleanup portainer-app portainer-watchtower portainer/templates
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

networks:
  default:
    external:
      name: traefik